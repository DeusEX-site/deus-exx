# üöÄ –°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–ø –ø–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—é aff, brok, geo

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–∞–ø—ã –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —Å —Å–æ–≤–ø–∞–¥–∞—é—â–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
- **Aff** (Affiliate) - –Ω–∞–∑–≤–∞–Ω–∏–µ –∞—Ñ—Ñ–∏–ª–µ–π—Ç–∞
- **Brok** (Broker) - –Ω–∞–∑–≤–∞–Ω–∏–µ –±—Ä–æ–∫–µ—Ä–∞  
- **Geo** - –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### ‚úÖ 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–ø
- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–∞–ø–æ–π —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏
- –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ aff + brok + geo ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–∞–ø—É
- –ï—Å–ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –Ω–µ—Ç ‚Üí —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –∫–∞–ø—É

### ‚úÖ 2. –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ö–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–∞–ø—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ `cap_history`
- –¢–∏–ø—ã –¥–µ–π—Å—Ç–≤–∏–π: `created`, `updated`, `replaced`
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å—Ç–∞—Ä—ã–µ –∏ –Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –£–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏—á–∏–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –∏—Å—Ç–æ—á–Ω–∏–∫

### ‚úÖ 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç—å—é
- –ò—Å—Ç–æ—Ä–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é **—Å–∫—Ä—ã—Ç–∞** –≤ –≤—ã–ø–∞–¥–∞—é—â–µ–º —Å–ø–∏—Å–∫–µ
- –ú–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –∏—Å—Ç–æ—Ä–∏–∏
- –ö–Ω–æ–ø–∫–∞ "–ü–æ–∫–∞–∑–∞—Ç—å —Å–∫—Ä—ã—Ç—ã–µ" –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏

### ‚úÖ 4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–ø –∏ –∑–∞–ø–∏—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∑–∞ —Å–µ–≥–æ–¥–Ω—è
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∫—Ä—ã—Ç—ã—Ö/–≤–∏–¥–∏–º—ã—Ö –∑–∞–ø–∏—Å–µ–π
- –ü–æ–∏—Å–∫ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **CapUpdateService** - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–ø
2. **CapHistory** - –º–æ–¥–µ–ª—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
3. **TelegramWebhookController** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram webhook
4. **Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ cap-analysis

### –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã:

#### `cap_history`
```sql
- id: BIGINT (Primary Key)
- cap_id: BIGINT (Foreign Key ‚Üí caps.id)
- message_id: BIGINT (Foreign Key ‚Üí messages.id)
- action_type: VARCHAR ('created', 'updated', 'replaced')
- old_values: JSON (–ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è)
- cap_amounts: JSON
- total_amount: INT
- schedule: VARCHAR
- date: VARCHAR
- is_24_7: BOOLEAN
- affiliate_name: VARCHAR
- broker_name: VARCHAR
- geos: JSON
- work_hours: VARCHAR
- highlighted_text: TEXT
- reason: TEXT (–ø—Ä–∏—á–∏–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
- updated_by: VARCHAR ('system', 'user')
- is_hidden: BOOLEAN (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é TRUE)
- created_at: TIMESTAMP
- updated_at: TIMESTAMP
```

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (Windows):
```bash
setup-cap-update-system.bat
```

### –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞:
```bash
# 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∏—Å—Ç–æ—Ä–∏–∏
php artisan migrate:cap-history

# 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
php artisan test:cap-update-system
```

## üîÑ –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

### –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–∞–ø–æ–π:

1. **–ü–∞—Ä—Å–∏–Ω–≥ —Å–æ–æ–±—â–µ–Ω–∏—è** - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ aff, brok, geo, cap amounts
2. **–ü–æ–∏—Å–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–∞–ø –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º
3. **–ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏—è:**
   - –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ ‚Üí **–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–∞–ø—ã
   - –ï—Å–ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –Ω–µ—Ç ‚Üí **—Å–æ–∑–¥–∞–Ω–∏–µ** –Ω–æ–≤–æ–π –∫–∞–ø—ã
4. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏** - –∑–∞–ø–∏—Å—å –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ `cap_history`
5. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∑–∞–ø–∏—Å—å –≤ –ª–æ–≥ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### –õ–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π:
```php
// –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ affiliate_name –ò broker_name
// + —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –≤ –º–∞—Å—Å–∏–≤–µ geos
$existingCap = Cap::where('affiliate_name', $affiliateName)
                  ->where('broker_name', $brokerName)
                  ->whereJsonContains('geos', $geo) // –¥–ª—è –∫–∞–∂–¥–æ–≥–æ geo
                  ->first();
```

## üìä Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –ù–æ–≤—ã–µ —Å–µ–∫—Ü–∏–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ /cap-analysis:

#### 1. üìà –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–ø
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ö–Ω–æ–ø–∫–∞ "–ü–æ–∫–∞–∑–∞—Ç—å —Å–∫—Ä—ã—Ç—ã–µ" –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è —Å–∫—Ä—ã—Ç—ã—Ö –∑–∞–ø–∏—Å–µ–π
- –ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å —Å–æ–¥–µ—Ä–∂–∏—Ç:
  - –¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è (—Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ/–∑–∞–º–µ–Ω–∞)
  - –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
  - –ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞
  - –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
  - –î–µ—Ç–∞–ª–∏ (aff, brok, geo, –ø—Ä–∏—á–∏–Ω–∞)
  - –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### 2. üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã –∫–∞–ø
- –í—Å–µ–≥–æ –∫–∞–ø
- –ó–∞–ø–∏—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–π —Å–µ–≥–æ–¥–Ω—è
- –ù–æ–≤—ã—Ö –∫–∞–ø —Å–µ–≥–æ–¥–Ω—è
- –°–∫—Ä—ã—Ç—ã—Ö –∑–∞–ø–∏—Å–µ–π

#### 3. üîç –î–µ—Ç–∞–ª–∏ –∫–∞–ø—ã (–º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ)
- –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–ø–µ
- –í—Å—è –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –û–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è

## üéÆ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞:
–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ Telegram webhook.

### –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
```php
// –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞
$capUpdateService = app(CapUpdateService::class);

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
$result = $capUpdateService->processNewMessage($messageId, $messageText);

// –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏
$history = $capUpdateService->getCapUpdates($capId, $includeHidden);

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏
$capUpdateService->toggleHistoryVisibility($historyId);
```

## üîß API Endpoints

### –ù–æ–≤—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã:
```php
GET  /api/cap/{capId}/history           // –ò—Å—Ç–æ—Ä–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞–ø—ã
POST /api/cap-history/{id}/toggle-visibility  // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∑–∞–ø–∏—Å—å
GET  /api/cap-updates/recent           // –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
GET  /api/cap-statistics              // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```bash
php artisan test:cap-update-system
```

### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è:
1. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–∞–ø
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–∞–ø –ø–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—é
3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
4. –†–∞–±–æ—Ç–∞ —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
5. –ü–æ–∏—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

## üìù –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞–ø—ã
```
–°–æ–æ–±—â–µ–Ω–∏–µ: "CAP 50 TestAff - TestBrok : RU,KZ 10-19"
–†–µ–∑—É–ª—å—Ç–∞—Ç: –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –∫–∞–ø–∞ + –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏–∏ (action_type: 'created')
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–∞–ø—ã
```
–ò—Å—Ö–æ–¥–Ω–∞—è –∫–∞–ø–∞: CAP 50 TestAff - TestBrok : RU,KZ 10-19
–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: "CAP 75 TestAff - TestBrok : RU,KZ,BY 12-20"
–†–µ–∑—É–ª—å—Ç–∞—Ç: –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∫–∞–ø–∞ + –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏–∏ (action_type: 'updated')
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞–ø—ã (–Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è)
```
–ò—Å—Ö–æ–¥–Ω–∞—è –∫–∞–ø–∞: CAP 50 TestAff - TestBrok : RU,KZ
–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: "CAP 30 OtherAff - OtherBrok : DE,FR"
–†–µ–∑—É–ª—å—Ç–∞—Ç: –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –∫–∞–ø–∞ (–Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø–æ aff/brok)
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### –õ–æ–≥–∏–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π:
- –¢—Ä–µ–±—É–µ—Ç—Å—è **—Ç–æ—á–Ω–æ–µ** —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ `affiliate_name` –ò `broker_name`
- –¢—Ä–µ–±—É–µ—Ç—Å—è **—Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ** —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –≤ –º–∞—Å—Å–∏–≤–µ `geos`
- –†–µ–≥–∏—Å—Ç—Ä —Å–∏–º–≤–æ–ª–æ–≤ **—É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è**

### –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–ø–∏—Å–∏ **—Å–∫—Ä—ã—Ç—ã** (`is_hidden = true`)
- –ó–∞–ø–∏—Å–∏ —Ç–∏–ø–∞ `created` –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è (`is_hidden = false`)
- –ú–æ–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —É–ø—Ä–∞–≤–ª—è—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å—é

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- –ò–Ω–¥–µ–∫—Å—ã –ø–æ –≤—Å–µ–º –∫–ª—é—á–µ–≤—ã–º –ø–æ–ª—è–º
- Cascade —É–¥–∞–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–∞–ø
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—ã–≤–æ–¥–∞ –∏—Å—Ç–æ—Ä–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10 –∑–∞–ø–∏—Å–µ–π)

## üîç –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏:
–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ Laravel –ª–æ–≥ —Å —É—Ä–æ–≤–Ω–µ–º `info`:
```php
Log::info('Cap message processed', [
    'message_id' => $messageId,
    'updated_caps' => $result['updated_caps'],
    'new_caps' => $result['new_caps']
]);
```

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
php artisan tinker
>>> app(\App\Services\CapUpdateService::class)->getUpdateStatistics()

# –ü–æ–∏—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
>>> app(\App\Services\CapUpdateService::class)->findPotentialDuplicates()
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–°–∏—Å—Ç–µ–º–∞ —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –≤–∫–ª—é—á–∞–µ—Ç:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–ø –ø–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—é aff, brok, geo
- –ü–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç—å—é
- –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å —Å–µ–∫—Ü–∏—è–º–∏ –∏—Å—Ç–æ—Ä–∏–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- –ü—Ä–æ—Å—Ç—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É —á–µ—Ä–µ–∑ bat-—Ñ–∞–π–ª

üåê **–û—Ç–∫—Ä–æ–π—Ç–µ /cap-analysis –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏!** 