# Руководство по тестированию системы

## Обзор
Этот документ описывает все доступные тестовые файлы и скрипты для отладки системы анализа капы.

## Batch файлы для тестирования

### 1. `run-all-tests.bat`
**Назначение**: Запускает все тесты по очереди с паузой между каждым тестом.

**Использование**:
```bash
run-all-tests.bat
```

**Особенности**:
- Включает все 20 тестов
- Пауза по Enter между тестами
- Подходит для полной отладки системы
- Возможность прерывания через Ctrl+C

### 2. `run-core-tests.bat`
**Назначение**: Запускает только основные тесты системы.

**Использование**:
```bash
run-core-tests.bat
```

**Включает**:
- Тест полной системы
- Тест системы анализа капы
- Тест новой системы капы
- Тест парсинга капы
- Тест системы истории капы
- Тест позиций чата

### 3. `test-menu.bat`
**Назначение**: Интерактивное меню для выбора групп тестов.

**Использование**:
```bash
test-menu.bat
```

**Возможности**:
- Выбор отдельных групп тестов
- Тесты системы капы
- Тесты позиций и чатов
- Тесты парсинга и расписания
- Тесты сообщений и обмена
- Отдельные PHP файлы тестов

### 4. `run-tests-auto.bat`
**Назначение**: Автоматический запуск всех тестов без пауз.

**Использование**:
```bash
run-tests-auto.bat
```

**Особенности**:
- Сохраняет результаты в `test-results.log`
- Показывает коды возврата
- Подходит для CI/CD
- Временные метки для каждого теста

## Artisan команды тестирования

### Тесты системы капы
```bash
php artisan test:cap-analysis          # Тест системы анализа капы
php artisan test:cap-history-system    # Тест системы истории капы
php artisan test:cap-status-system     # Тест системы статуса капы
php artisan test:new-cap-system        # Тест новой системы капы
```

### Тесты позиций и чатов
```bash
php artisan test:chat-positions        # Тест позиций чата
php artisan test:position-stability    # Тест стабильности позиций
php artisan test:top-ten-rule          # Тест правила топ-10
php artisan test:top-three-stability   # Тест стабильности топ-3
```

### Тесты сообщений
```bash
php artisan test:outgoing-messages     # Тест исходящих сообщений
php artisan test:swap-messages         # Тест сообщений обмена
php artisan test:replacement-logic     # Тест логики замены
```

### Общие тесты
```bash
php artisan test:full-system           # Тест полной системы
```

## Отдельные PHP файлы тестов

### Тесты парсинга
```bash
php test_cap_parsing.php               # Тест парсинга капы
php test_schedule_parsing.php          # Тест парсинга расписания
php test_multi_schedule_parsing.php    # Тест парсинга мульти-расписания
```

### Тесты полей и данных
```bash
php test_empty_fields.php              # Тест пустых полей
php test_empty_fields_debug.php        # Тест отладки пустых полей
```

### Тесты системы
```bash
php test_cap_history_system.php        # Тест системы истории капы
php test_reply_update_system.php       # Тест системы обновления ответов
php test_status_commands_multi.php     # Тест мульти-команд статуса
```

## Рекомендации по использованию

### Для начальной отладки
1. Запустите `run-core-tests.bat` для проверки основных компонентов
2. Если есть проблемы, используйте `test-menu.bat` для тестирования отдельных групп

### Для полной отладки
1. Запустите `run-all-tests.bat` для проверки всех компонентов
2. Внимательно изучите результаты каждого теста

### Для автоматизации
1. Используйте `run-tests-auto.bat` для CI/CD
2. Проверьте файл `test-results.log` на наличие ошибок

### Для отладки конкретных проблем
1. Используйте `test-menu.bat` для выбора конкретной группы тестов
2. Запускайте отдельные команды для детального анализа

## Интерпретация результатов

### Успешный тест
```
✅ Тест пройден успешно
✅ Все проверки выполнены
✅ Нет ошибок
```

### Неуспешный тест
```
❌ Ошибка в тесте
❌ Неожиданное поведение
❌ Проверьте конфигурацию
```

### Предупреждения
```
⚠️ Предупреждение
⚠️ Возможная проблема
⚠️ Требует внимания
```

## Файл результатов

Файл `test-results.log` содержит:
- Временные метки для каждого теста
- Полный вывод команд
- Коды возврата
- Ошибки и предупреждения

## Советы по отладке

1. **Начинайте с основных тестов** - используйте `run-core-tests.bat`
2. **Изучайте логи** - всегда проверяйте вывод команд
3. **Тестируйте по группам** - используйте `test-menu.bat`
4. **Сохраняйте результаты** - используйте `run-tests-auto.bat`
5. **Проверяйте зависимости** - убедитесь, что база данных настроена

## Устранение проблем

### Ошибки подключения к БД
```bash
php artisan migrate:fresh --seed
```

### Ошибки в конфигурации
```bash
php artisan config:clear
php artisan cache:clear
```

### Ошибки в Artisan командах
```bash
php artisan list | grep test
```

## Структура тестирования

```
Тесты системы
├── Основные компоненты
│   ├── Анализ капы
│   ├── История капы
│   └── Статус капы
├── Позиции и чаты
│   ├── Позиции чата
│   ├── Стабильность позиций
│   └── Правила топ-10/топ-3
├── Парсинг и расписание
│   ├── Парсинг капы
│   ├── Парсинг расписания
│   └── Мульти-расписание
└── Сообщения и обмен
    ├── Исходящие сообщения
    ├── Сообщения обмена
    └── Логика замены
```

## Заключение

Используйте эти тестовые файлы для систематической отладки системы анализа капы. Начинайте с основных тестов и постепенно переходите к более специфическим компонентам. 