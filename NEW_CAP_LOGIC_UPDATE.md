# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∫–∞–ø –ø–æ –≥–µ–æ

## üîÑ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

**–°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞:**
- Affiliate –∏ Recipient –º–æ–≥–ª–∏ –±—ã—Ç—å —Å–ø–∏—Å–∫–∞–º–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
- –°–æ–∑–¥–∞–≤–∞–ª–∏—Å—å –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ Affiliate √ó Recipient
- `Affiliate: A1, A2` + `Recipient: R1, R2` = 4 –∑–∞–ø–∏—Å–∏

**–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞:**
- Affiliate –∏ Recipient - —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è–º
- `Geo: GT PE MX` = 3 –∑–∞–ø–∏—Å–∏ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

## üìã –ù–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞

### –ü–æ–ª—è —Å –æ–¥–Ω–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
- **Affiliate**: `Affiliate: Webgate` (–±–µ–∑ –∑–∞–ø—è—Ç—ã—Ö)
- **Recipient**: `Recipient: TradingM` (–±–µ–∑ –∑–∞–ø—è—Ç—ã—Ö)

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≥–µ–æ
- **Geo**: `Geo: GT PE MX` ‚Üí 3 –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø–∏—Å–∏
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏**: –ø—Ä–æ–±–µ–ª—ã, –∑–∞–ø—è—Ç—ã–µ, —Å–ª–µ—à–∏
- **–ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å**: —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –≥–µ–æ

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### app/Services/CapAnalysisService.php
```php
// –°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞
foreach ($affiliates as $affiliate) {
    foreach ($recipients as $recipient) {
        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
    }
}

// –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
foreach ($baseData['geos'] as $geo) {
    $combination = $baseData;
    $combination['geos'] = [$geo]; // –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –≥–µ–æ
    $combinations[] = $combination;
}
```

### –ü—Ä–∏–º–µ—Ä—ã –ø–∞—Ä—Å–∏–Ω–≥–∞
```php
// Geo —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏
"Geo: GT PE MX"      ‚Üí ["GT", "PE", "MX"]
"Geo: IE, DE, FR"    ‚Üí ["IE", "DE", "FR"]  
"Geo: RU/UA/KZ"      ‚Üí ["RU", "UA", "KZ"]
"Geo: US,CA AU"      ‚Üí ["US", "CA", "AU"]
```

## üìä –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

### –ü—Ä–∏–º–µ—Ä 1: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≥–µ–æ
**–í—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:**
```
Affiliate: Webgate
Recipient: TradingM
Cap: 20
Total: 200
Geo: GT PE MX
Language: es
Funnel: Crypto
Schedule: 24/7
Date: 24.02
Pending ACQ: Yes
Freeze status on ACQ: No
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:**
```
–ó–∞–ø–∏—Å—å 1: Webgate - TradingM (Cap: 20, Geo: GT, Date: 24.02.2024)
–ó–∞–ø–∏—Å—å 2: Webgate - TradingM (Cap: 20, Geo: PE, Date: 24.02.2024)
–ó–∞–ø–∏—Å—å 3: Webgate - TradingM (Cap: 20, Geo: MX, Date: 24.02.2024)
```

### –ü—Ä–∏–º–µ—Ä 2: –û–¥–Ω–æ –≥–µ–æ
**–í—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:**
```
Affiliate: TestAffiliate
Recipient: TestBroker
Cap: 30
Geo: RU
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:**
```
–ó–∞–ø–∏—Å—å 1: TestAffiliate - TestBroker (Cap: 30, Geo: RU)
```

### –ü—Ä–∏–º–µ—Ä 3: –ë–µ–∑ –≥–µ–æ
**–í—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:**
```
Affiliate: TestAffiliate
Recipient: TestBroker
Cap: 25
Geo: 
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:**
```
–ó–∞–ø–∏—Å—å 1: TestAffiliate - TestBroker (Cap: 25, Geo: [])
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏

1. **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –ù–µ—Ç —Å–ª–æ–∂–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π Affiliate √ó Recipient
2. **–õ–æ–≥–∏—á–Ω–æ—Å—Ç—å**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ä–µ–∞–ª—å–Ω–æ–º—É –∫—Ä–∏—Ç–µ—Ä–∏—é (–≥–µ–æ–≥—Ä–∞—Ñ–∏—è)
3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ú–µ–Ω—å—à–µ –∑–∞–ø–∏—Å–µ–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
4. **–ü–æ–Ω—è—Ç–Ω–æ—Å—Ç—å**: –ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å = –æ–¥–Ω–∞ –∫–∞–ø–∞ –¥–ª—è –æ–¥–Ω–æ–≥–æ –≥–µ–æ

## üìù –ß—Ç–æ –Ω—É–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å

- **Affiliate –∏ Recipient** - –≤—Å–µ–≥–¥–∞ –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ
- **Geo** - –º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª—ã/–∑–∞–ø—è—Ç—ã–µ/—Å–ª–µ—à–∏
- **–ö–∞–∂–¥–æ–µ –≥–µ–æ** = –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- **–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è** –æ–¥–∏–Ω–∞–∫–æ–≤—ã –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

```bash
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏
php artisan update:new-cap-format --test

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
php artisan test:new-cap-system
```

## ‚úÖ –°—Ç–∞—Ç—É—Å

- ‚úÖ –õ–æ–≥–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –≤ `CapAnalysisService.php`
- ‚úÖ –¢–µ—Å—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤ `UpdateToNewCapFormat.php`
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –≤ `NEW_CAP_FORMAT_README.md`
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤–æ –≤—Å–µ—Ö —Ñ–∞–π–ª–∞—Ö

üéâ **–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** 