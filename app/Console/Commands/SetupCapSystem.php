<?php

namespace App\Console\Commands;

use Illuminate\Console\Command;
use Illuminate\Support\Facades\Artisan;

class SetupCapSystem extends Command
{
    protected $signature = 'setup:cap-system {--test : –¢–∞–∫–∂–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã}';
    protected $description = '–ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –∫–∞–ø';

    public function handle()
    {
        $this->info('üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –∫–∞–ø...');
        
        // –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
        $this->info('üìã –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã caps...');
        $exitCode = Artisan::call('migrate:caps');
        if ($exitCode === 0) {
            $this->info('‚úÖ –¢–∞–±–ª–∏—Ü–∞ caps —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ!');
        } else {
            $this->error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã caps');
            return Command::FAILURE;
        }
        
        // –®–∞–≥ 2: –ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
        $this->info('üîç –®–∞–≥ 2: –ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π...');
        $exitCode = Artisan::call('analyze:existing-messages', ['--limit' => 1000]);
        if ($exitCode === 0) {
            $this->info('‚úÖ –ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω!');
        } else {
            $this->error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π');
            return Command::FAILURE;
        }
        
        // –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–µ—Å–ª–∏ –∑–∞–ø—Ä–æ—à–µ–Ω–æ)
        if ($this->option('test')) {
            $this->info('üß™ –®–∞–≥ 3: –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤...');
            $exitCode = Artisan::call('test:new-cap-system');
            if ($exitCode === 0) {
                $this->info('‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ!');
            } else {
                $this->error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ç–µ—Å—Ç–æ–≤');
                return Command::FAILURE;
            }
        }
        
        $this->info('');
        $this->info('üéâ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!');
        $this->info('');
        $this->info('üìä –¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –∫–∞–ø —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:');
        $this->info('   ‚Ä¢ –ö–∞–∂–¥–∞—è –∫–∞–ø–∞ —Å–æ–∑–¥–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é –∑–∞–ø–∏—Å—å');
        $this->info('   ‚Ä¢ –ù–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏');
        $this->info('   ‚Ä¢ –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–æ —á–µ—Ä–µ–∑ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö');
        $this->info('   ‚Ä¢ –ö–∞–∂–¥–∞—è –∫–∞–ø–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ');
        $this->info('');
        $this->info('üåê –û—Ç–∫—Ä–æ–π—Ç–µ /cap-analysis –≤ –±—Ä–∞—É–∑–µ—Ä–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤');
        
        return Command::SUCCESS;
    }
} 