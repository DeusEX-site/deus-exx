# üéØ –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –ø–æ–∑–∏—Ü–∏–π —á–∞—Ç–æ–≤

## –û–ø–∏—Å–∞–Ω–∏–µ
–°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –ø–µ—Ä–≤—ã—Ö 3 —á–∞—Ç–æ–≤ –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –ï—Å–ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç –Ω–æ–º–µ—Ä 3 –∏ –±–æ–ª–µ–µ, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç —á–∞—Ç –≤ –ø–µ—Ä–≤–æ–º —Ä—è–¥—É (–∏–∑ —Ç–æ–ø-3) —É –∫–æ—Ç–æ—Ä–æ–≥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª—å—à–µ –º–∏–Ω—É—Ç—ã –Ω–∞–∑–∞–¥ –∏ –ø–ª–∞–≤–Ω–æ –º–µ–Ω—è–µ—Ç —á–∞—Ç—ã –º–µ—Å—Ç–∞–º–∏.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –ø–µ—Ä–≤—ã—Ö 3 —á–∞—Ç–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (–∫—Ä–∏—Ç–µ—Ä–∏–π: –±–æ–ª–µ–µ 1 –º–∏–Ω—É—Ç—ã)
- ‚úÖ –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏ —á–∞—Ç–æ–≤
- ‚úÖ –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Ç–æ–ø-3 —á–∞—Ç–æ–≤
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ–∑–∏—Ü–∏–π
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
```bash
php artisan migrate
```

### 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ø–æ–∑–∏—Ü–∏–∏ —á–∞—Ç–æ–≤
```bash
php artisan chats:init-positions
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã
```bash
php artisan chats:test-positions
```

## –ö–æ–º–∞–Ω–¥—ã

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π
```bash
php artisan chats:init-positions
```
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–∞—á–∞–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —á–∞—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
php artisan chats:test-positions

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–∞—Ç–∞
php artisan chats:test-positions --chat-id=123
```

## API Endpoints

### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π —á–∞—Ç–æ–≤
```
GET /api/chats/positions
```

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π
```
POST /api/chats/init-positions
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —á–∞—Ç–æ–≤ (—Å —É—á–µ—Ç–æ–º –ø–æ–∑–∏—Ü–∏–π)
```
GET /api/chats
```

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
- `display_order` - —á–∏—Å–ª–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ —á–∞—Ç–∞
- –¢–æ–ø-3 —á–∞—Ç–∞ –∏–º–µ—é—Ç `display_order > 0`
- –û—Å—Ç–∞–ª—å–Ω—ã–µ —á–∞—Ç—ã –∏–º–µ—é—Ç `display_order = 0`

### 2. –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã
1. –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `ChatPositionService::handleNewMessage()`
2. **–ï—Å–ª–∏ —á–∞—Ç —É–∂–µ –≤ —Ç–æ–ø-3**: –ø–æ–∑–∏—Ü–∏—è –ù–ï –∏–∑–º–µ–Ω—è–µ—Ç—Å—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `no_change`
3. **–ï—Å–ª–∏ —á–∞—Ç –Ω–µ –≤ —Ç–æ–ø-3**: –∏—â–µ—Ç—Å—è —á–∞—Ç –≤ —Ç–æ–ø-3 —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –¥–æ–ª—å—à–µ –º–∏–Ω—É—Ç—ã
4. **–ü—Ä–∏ –∑–∞–º–µ–Ω–µ**: –º–µ–Ω—è—é—Ç—Å—è –º–µ—Å—Ç–∞–º–∏ —Ç–æ–ª—å–∫–æ 2 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —á–∞—Ç–∞ (–∑–∞–º–µ–Ω—è–µ–º—ã–π –∏ –Ω–æ–≤—ã–π)
5. **–û—Å—Ç–∞–ª—å–Ω—ã–µ —á–∞—Ç—ã —Ç–æ–ø-3**: –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ —Å–≤–æ–∏—Ö –ø–æ–∑–∏—Ü–∏—è—Ö –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 3. –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è
- –ß–∞—Ç—ã –≤ —Ç–æ–ø-3 –∏–º–µ—é—Ç –∑–µ–ª–µ–Ω—É—é –≥—Ä–∞–Ω–∏—Ü—É —Å–ª–µ–≤–∞
- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–¢–û–ü 1", "–¢–û–ü 2", "–¢–û–ü 3"
- **–ü—Ä–∏ –≤—Ö–æ–¥–µ –≤ —Ç–æ–ø-3**: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∑–µ–ª–µ–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "‚¨ÜÔ∏è –¢–û–ü"
- **–ü—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Ç–æ–ø-3**: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫—Ä–∞—Å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "‚¨áÔ∏è"
- **–ï—Å–ª–∏ —á–∞—Ç –æ—Å—Ç–∞–µ—Ç—Å—è –≤ —Ç–æ–ø-3**: –∞–Ω–∏–º–∞—Ü–∏—è –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è

## –§–∞–π–ª—ã —Å–∏—Å—Ç–µ–º—ã

### Backend
- `app/Models/Chat.php` - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å —á–∞—Ç–∞
- `app/Services/ChatPositionService.php` - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
- `app/Console/Commands/InitializeChatPositions.php` - –∫–æ–º–∞–Ω–¥–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- `app/Console/Commands/TestChatPositions.php` - –∫–æ–º–∞–Ω–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `database/migrations/2024_12_19_000004_add_display_order_to_chats_table.php` - –º–∏–≥—Ä–∞—Ü–∏—è

### Frontend
- `resources/views/dashboard.blade.php` - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
- CSS –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –ø–ª–∞–≤–Ω–æ–π —Å–º–µ–Ω—ã –ø–æ–∑–∏—Ü–∏–π
- JavaScript –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–∏
–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è (1 –º–∏–Ω—É—Ç–∞) –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ —Ñ–∞–π–ª–µ `app/Services/ChatPositionService.php`:
```php
$oneMinuteAgo = Carbon::now()->subMinute(); // –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω–æ–µ –≤—Ä–µ–º—è
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ Laravel –ª–æ–≥:
```
Log::info('Chat positions swapped', [
    'promoted_chat' => $chat->id,
    'demoted_chat' => $chatToReplace->id,
    // ...
]);
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- Throttling –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- Laravel 10+
- PHP 8.1+
- MySQL/PostgreSQL
- Modern browsers –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞
–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º Telegram Dashboard –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π. 