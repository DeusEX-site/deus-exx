# üìö –°–∏—Å—Ç–µ–º–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∫–∞–ø

## üéØ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–æ–≤–æ–π –∫–∞–ø—ã —Å–∏—Å—Ç–µ–º–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã** –ø–æ –ø–æ–ª—è–º:
- `affiliate_name` 
- `recipient_name`
- `geos` (–æ–¥–Ω–∞ –∫–∞–ø–∞ = –æ–¥–Ω–æ –≥–µ–æ)

## üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–π –∫–∞–ø—ã:

**–ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω –¥—É–±–ª–∏–∫–∞—Ç:**
1. ‚úÖ –ö–æ–ø–∏—Ä—É–µ—Ç —Å—Ç–∞—Ä—É—é –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É `caps_history`
2. ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å **—Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏**
3. ‚úÖ –ù–µ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å

**–ï—Å–ª–∏ –¥—É–±–ª–∏–∫–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω:**
1. ‚úÖ –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `caps`

### 2. –£–º–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π:

–û–±–Ω–æ–≤–ª—è—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ —Ç–µ –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å**:
- `cap_amounts` - —Å—É–º–º–∞ –∫–∞–ø—ã
- `total_amount` - –æ–±—â–∏–π –ª–∏–º–∏—Ç  
- `schedule` - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
- `date` - –¥–∞—Ç–∞
- `language` - —è–∑—ã–∫
- `funnel` - –≤–æ—Ä–æ–Ω–∫–∞
- `pending_acq` - –æ–∂–∏–¥–∞–Ω–∏–µ ACQ
- `freeze_status_on_acq` - –∑–∞–º–æ—Ä–æ–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
- `start_time`, `end_time`, `timezone` - –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã
- `highlighted_text` - —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è

## üóÉÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `caps_history`
–°–æ–¥–µ—Ä–∂–∏—Ç –∞—Ä—Ö–∏–≤–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –∫–∞–ø —Å –ø–æ–ª—è–º–∏:
- `cap_id` - ID –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –∫–∞–ø—ã
- `message_id` - ID —Å–æ–æ–±—â–µ–Ω–∏—è  
- –í—Å–µ –ø–æ–ª—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `caps`
- `archived_at` - –¥–∞—Ç–∞ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏

### –°–≤—è–∑–∏:
- `caps_history.cap_id` ‚Üí `caps.id`
- `caps_history.message_id` ‚Üí `messages.id`
- `caps.history()` - –ø–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π

## üïí –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –ø–∞—Ä—Å–∏–Ω–≥–µ GMT

### –ë—ã–ª–æ:
```
Schedule: 18:00/01:00 18:00/02:00 GMT+03:00
```
GMT –ø—Ä–∏–º–µ–Ω—è–ª—Å—è —Ç–æ–ª—å–∫–æ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –≤—Ä–µ–º–µ–Ω–∏.

### –°—Ç–∞–ª–æ:
```
Schedule: 18:00/01:00 18:00/02:00 GMT+03:00
```
GMT –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è **–∫–æ –≤—Å–µ–º –≤—Ä–µ–º–µ–Ω–∞–º** –≤ —Å—Ç—Ä–æ–∫–µ:
- `18:00/01:00 GMT+03:00`
- `18:00/02:00 GMT+03:00`

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
# Windows
test-cap-history-system.bat

# Linux/Mac  
php artisan test:cap-history
```

### –†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
```bash
php artisan test:cap-history --clear
```

## üìä –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

### –ü—Ä–∏–º–µ—Ä 1: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞–ø—ã
```
Affiliate: TestAff
Recipient: TestRec  
Cap: 50
Geo: US
...
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å –≤ `caps`

### –ü—Ä–∏–º–µ—Ä 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–∞–ø—ã
```
Affiliate: TestAff
Recipient: TestRec
Cap: 75  ‚Üê –ò–ó–ú–ï–ù–ï–ù–û
Geo: US  ‚Üê –¢–û–¢ –ñ–ï
...
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 
1. –°—Ç–∞—Ä–∞—è –∑–∞–ø–∏—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ `caps_history`
2. –û–±–Ω–æ–≤–ª–µ–Ω–æ —Ç–æ–ª—å–∫–æ –ø–æ–ª–µ `cap_amounts` –≤ `caps`

### –ü—Ä–∏–º–µ—Ä 3: –ü–æ–ø—ã—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
```
Affiliate: TestAff
Recipient: TestRec
Cap: 75  ‚Üê –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô
Geo: US  ‚Üê –¢–û–¢ –ñ–ï
...
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ –≤–Ω–µ—Å–µ–Ω–æ

## üîç –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ù–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤** - –∫–∞–∂–¥–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è affiliate+recipient+geo —É–Ω–∏–∫–∞–ª—å–Ω–∞
2. **–ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è** - –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
3. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** - –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—è
4. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π GMT** - timezone –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è–º
5. **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–≤—è–∑–∏ –∏ –∫–∞—Å–∫–∞–¥–Ω—ã–µ —É–¥–∞–ª–µ–Ω–∏—è

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

- –û–¥–Ω–∞ –∫–∞–ø–∞ = –æ–¥–Ω–æ –≥–µ–æ (—Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø–∏—Å–∏)
- –ü–æ–∏—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Ç–æ—á–Ω—ã–π: –≤—Å–µ —Ç—Ä–∏ –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å
- –ò—Å—Ç–æ—Ä–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- GMT –ø–∞—Ä—Å–∏—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –≤—Å–µ–π —Å—Ç—Ä–æ–∫–∏ Schedule 