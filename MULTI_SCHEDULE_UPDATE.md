# Обновление парсинга множественных расписаний

## Проблема
При указании нескольких расписаний в одной строке, система не корректно распознавала их и применяла только первое расписание ко всем капам.

Например:
```
Schedule: 18:00/01:00 18:00/02:00 GMT+03:00
```
Должно было создать два разных расписания, но система видела это как одно.

## Обновленная логика parseScheduleValues

### Поддержка разделителей
1. **Запятая**: `10-19, 10-17` - основной разделитель
2. **Пробел**: `18:00/01:00 18:00/02:00` - для расписаний без запятых

### Обработка общего часового пояса
Если часовой пояс указан в конце строки, он применяется ко всем расписаниям:
```
Schedule: 8.30 - 14.30 9.30 - 14.30 +3
Результат:
- "8:30/14:30 GMT+03:00"
- "9:30/14:30 GMT+03:00"
```

### Регулярное выражение для поиска расписаний
```php
$pattern = '/(?:(?:\d{1,2}[:.]\d{2}|\d{1,2})\s*[-–\/]\s*(?:\d{1,2}[:.]\d{2}|\d{1,2}))/';
```

Распознает форматы:
- `18:00/01:00`
- `8.30 - 14.30`
- `10-19`
- `10:00 – 19:00` (с длинным тире)

## Логика привязки по колонкам

### Правила применения
1. **Одно расписание**: Применяется ко всем капам
2. **Количество расписаний = количество кап**: Привязка по порядку
3. **Расписаний меньше чем кап**: Недостающим капам назначается значение по умолчанию `24/7`

### Примеры

#### Пример 1: Равное количество
```
Cap: 20 30 30
Geo: KZ1 KZ2 KZ3
Schedule: 18:00/01:00 18:00/02:00 10:00/19:00
```
Результат:
- KZ1 → 18:00/01:00
- KZ2 → 18:00/02:00  
- KZ3 → 10:00/19:00

#### Пример 2: Меньше расписаний
```
Cap: 20 30 30
Geo: KZ1 KZ2 KZ3
Schedule: 18:00/01:00 18:00/02:00
```
Результат:
- KZ1 → 18:00/01:00
- KZ2 → 18:00/02:00
- KZ3 → 24/7 (по умолчанию)

#### Пример 3: Одно расписание
```
Cap: 20 30 30
Geo: KZ1 KZ2 KZ3
Schedule: 10:00/19:00
```
Результат:
- KZ1 → 10:00/19:00
- KZ2 → 10:00/19:00
- KZ3 → 10:00/19:00

## Поддерживаемые форматы

### Варианты записи
1. `Schedule: 10-19 10-17` (пробел)
2. `Schedule: 10-19, 10-17` (запятая)
3. `Schedule: 8.30 - 14.30 9.30 - 14.30 +3` (пробел + timezone)
4. `Schedule: 8.30 - 14.30, 9.30 - 14.30 +3` (запятая + timezone)
5. `Schedule: 18:00/01:00 18:00/02:00 GMT+03:00` (слэш + timezone)

### Нормализация времени
- Точки заменяются на двоеточия: `8.30` → `8:30`
- Добавляются минуты: `10-19` → `10:00/19:00`
- Нормализуется timezone: `+3` → `GMT+03:00`

## Тестирование
Для проверки множественных расписаний:
```bash
php test_multi_schedule_parsing.php
```

или через батник:
```bash
test-multi-schedule.bat
```

## Применение
Обновление работает как для создания новых кап, так и для обновления существующих через reply-сообщения. 