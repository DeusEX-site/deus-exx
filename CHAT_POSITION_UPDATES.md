# ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç—Ä–æ–ª—è –ø–æ–∑–∏—Ü–∏–π —á–∞—Ç–æ–≤

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞

### ‚ùå –ë—ã–ª–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç –∏–∑ —Ç–æ–ø-3 ‚Üí –ø–æ–∑–∏—Ü–∏—è –º–æ–≥–ª–∞ –∏–∑–º–µ–Ω–∏—Ç—å—Å—è
- –ü—Ä–∏ —Å–º–µ–Ω–µ –ø–æ–∑–∏—Ü–∏–π –¥–≤–∏–≥–∞–ª–∏—Å—å –≤—Å–µ —á–∞—Ç—ã –≤ —Ç–æ–ø-3
- –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞—Å—å –¥–ª—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ–∑–∏—Ü–∏–π

### ‚úÖ –°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
- **–ò—Å—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –±–æ—Ç–∞** ‚Üí –ù–ï –≤–ª–∏—è—é—Ç –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ —á–∞—Ç–æ–≤ –≤–æ–æ–±—â–µ
- **–¢–æ–ª—å–∫–æ –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è** ‚Üí —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–π
- **–ï—Å–ª–∏ —á–∞—Ç —É–∂–µ –≤ —Ç–æ–ø-10** ‚Üí –ø–æ–∑–∏—Ü–∏—è –ù–ï –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –≤–æ–æ–±—â–µ
- **–ü—Ä–∏ –∑–∞–º–µ–Ω–µ** ‚Üí –º–µ–Ω—è—é—Ç—Å—è –º–µ—Å—Ç–∞–º–∏ —Ç–æ–ª—å–∫–æ 2 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —á–∞—Ç–∞
- **–û—Å—Ç–∞–ª—å–Ω—ã–µ —á–∞—Ç—ã —Ç–æ–ø-10** ‚Üí –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ —Å–≤–æ–∏—Ö –ø–æ–∑–∏—Ü–∏—è—Ö
- **–ê–Ω–∏–º–∞—Ü–∏—è** ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—Ö–æ–¥–µ/–≤—ã—Ö–æ–¥–µ –∏–∑ —Ç–æ–ø-10

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### Backend (`app/Services/ChatPositionService.php`):
```php
// –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏—Å—Ö–æ–¥—è—â–µ–µ (–æ—Ç –±–æ—Ç–∞), –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏
if ($isOutgoing) {
    return ['status' => 'ignored', 'message' => 'Outgoing message ignored for position changes'];
}

// –ï—Å–ª–∏ —á–∞—Ç —É–∂–µ –≤ —Ç–æ–ø-10, –ø–æ–∑–∏—Ü–∏—è –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –≤–æ–æ–±—â–µ
if ($chat->isInTopTen()) {
    return ['status' => 'no_change', 'message' => 'Chat already in top 10, no position change needed'];
}
```

### Backend (`app/Http/Controllers/TelegramBotController.php`):
```php
// –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Å—á–µ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π, –ù–ï –æ–±–Ω–æ–≤–ª—è–µ–º last_message_at
// —Ç–∞–∫ –∫–∞–∫ –∏—Å—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –¥–æ–ª–∂–Ω—ã –≤–ª–∏—è—Ç—å –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ —á–∞—Ç–æ–≤
$chat->increment('message_count');
```

### Frontend (`resources/views/dashboard.blade.php`):
```javascript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π –¥–ª—è –≤—Å–µ—Ö —á–∞—Ç–æ–≤
// (–±–µ–∫–µ–Ω–¥ —Å–∞–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç, –Ω—É–∂–Ω–æ –ª–∏ —á—Ç–æ-—Ç–æ –º–µ–Ω—è—Ç—å)
setTimeout(() => {
    checkForPositionChanges();
}, 1000);
```

## –í–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

### –ü—Ä–∏ –≤—Ö–æ–¥–µ –≤ —Ç–æ–ø-3:
- üü¢ –ó–µ–ª–µ–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "‚¨ÜÔ∏è –¢–û–ü"
- –ê–Ω–∏–º–∞—Ü–∏—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Ç–æ–ø-3:
- üî¥ –ö—Ä–∞—Å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "‚¨áÔ∏è"
- –ê–Ω–∏–º–∞—Ü–∏—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

### –ï—Å–ª–∏ —á–∞—Ç –æ—Å—Ç–∞–µ—Ç—Å—è –≤ —Ç–æ–ø-3:
- ‚ùå –ù–∏–∫–∞–∫–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏
- ‚ùå –ù–∏–∫–∞–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
- ‚úÖ –ü–æ–∑–∏—Ü–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω–æ–π

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –°–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ç–æ–ø-3
```
1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç "–¢–û–ü 1", "–¢–û–ü 2" –∏–ª–∏ "–¢–û–ü 3"
2. –†–µ–∑—É–ª—å—Ç–∞—Ç: –ø–æ–∑–∏—Ü–∏—è –ù–ï –∏–∑–º–µ–Ω—è–µ—Ç—Å—è
3. –ù–∏–∫–∞–∫–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°–º–µ–Ω–∞ –ø–æ–∑–∏—Ü–∏–π
```
1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç –≤–Ω–µ —Ç–æ–ø-3
2. –†–µ–∑—É–ª—å—Ç–∞—Ç: –º–µ–Ω—è—é—Ç—Å—è –º–µ—Å—Ç–∞–º–∏ —Ç–æ–ª—å–∫–æ 2 —á–∞—Ç–∞
3. –ê–Ω–∏–º–∞—Ü–∏—è —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏ "‚¨ÜÔ∏è –¢–û–ü" –∏ "‚¨áÔ∏è"
```

## –û—Ç–ª–∞–¥–∫–∞

### –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞:
```javascript
// –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫ —á–∞—Ç–æ–≤ —Å display_order
console.log('Old chats order:', chats.map(c => `${c.id}:${c.display_order}`));
console.log('New chats order:', newChats.map(c => `${c.id}:${c.display_order}`));
```

### –õ–æ–≥–∏ Laravel:
```bash
tail -f storage/logs/laravel.log | grep -E "(Chat positions|no_change|swapped)"
```

## –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ç–æ–ø-3**: –ß–∞—Ç—ã –≤ —Ç–æ–ø-3 –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ —Å–≤–æ–∏—Ö –ø–æ–∑–∏—Ü–∏—è—Ö
2. **–¢–æ—á–µ—á–Ω–∞—è –∑–∞–º–µ–Ω–∞**: –ü—Ä–∏ —Å–º–µ–Ω–µ –ø–æ–∑–∏—Ü–∏–π –º–µ–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ 2 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —á–∞—Ç–∞
3. **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è**: –ê–Ω–∏–º–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∑–Ω–∞—á–∏–º—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö (–≤—Ö–æ–¥/–≤—ã—Ö–æ–¥ –∏–∑ —Ç–æ–ø-3)
4. **–õ–æ–≥–∏—á–µ—Å–∫–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ï—Å–ª–∏ —á–∞—Ç –∞–∫—Ç–∏–≤–µ–Ω –≤ —Ç–æ–ø-3, –æ–Ω —Ç–∞–º –∏ –æ—Å—Ç–∞–µ—Ç—Å—è

## –°—Ç–∞—Ç—É—Å: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é 